<div class="relative w-full overflow-hidden py-12 mb-12">
    <!-- Map Background -->
    <div class="absolute inset-0 bg-slate-900/50 rounded-3xl border border-dashed border-white/5 opacity-50"></div>

    <!-- Scroll Container -->
    <div class="overflow-x-auto pb-8 pt-4 custom-scrollbar relative z-10">
        <div class="flex items-center min-w-max px-12 gap-12 relative">

            <!-- Connection Line (SVG) - Absolute centered behind nodes -->
            <svg class="absolute top-1/2 left-0 w-full h-[4px] -translate-y-1/2 z-0 pointer-events-none"
                preserveAspectRatio="none">
                <line x1="0" y1="50%" x2="100%" y2="50%" stroke="#334155" stroke-width="4" stroke-dasharray="10 5" />
            </svg>

            {% for case in cases %}
            <!-- Map Node -->
            <div class="relative group z-10 flex flex-col items-center">

                <!-- Connector Line Overlay (Active Color) -->
                {% if case.status == 'solved' %}
                <div
                    class="absolute top-1/2 right-[-50%] w-[4rem] h-[4px] bg-cyan-500 -translate-y-1/2 z-[-1] hidden md:block">
                </div>
                {% endif %}

                <!-- Node Circle -->
                <a href="{% if case.status == 'locked' %}#{% else %}{% url 'case_detail' case.id %}{% endif %}" class="w-20 h-20 rounded-full flex items-center justify-center border-4 transition-all duration-500 transform relative
                          {% if case.status == 'solved' %}
                              bg-slate-900 border-cyan-500 shadow-[0_0_20px_rgba(34,211,238,0.5)] scale-100 hover:scale-110
                          {% elif case.status == 'active' %}
                              bg-cyan-600 border-white shadow-[0_0_30px_rgba(6,182,212,0.8)] animate-pulse scale-110
                          {% else %}
                              bg-slate-800 border-slate-600 grayscale opacity-70 cursor-not-allowed
                          {% endif %}">

                    {% if case.status == 'solved' %}
                    <span class="text-2xl">âœ…</span>
                    {% elif case.status == 'active' %}
                    <span class="text-2xl font-bold text-white">{{ forloop.counter }}</span>
                    <!-- Active Ping Animation -->
                    <span
                        class="absolute inline-flex h-full w-full rounded-full bg-cyan-400 opacity-20 animate-ping"></span>
                    {% else %}
                    <span class="text-2xl">ðŸ”’</span>
                    {% endif %}
                </a>

                <!-- Hover Tooltip (Game Style) -->
                <div
                    class="absolute top-24 w-64 bg-slate-900/95 backdrop-blur-md rounded-xl p-4 border border-cyan-500/30 opacity-0 group-hover:opacity-100 transition-all duration-300 transform translate-y-2 group-hover:translate-y-0 text-center pointer-events-none group-hover:pointer-events-auto z-50 shadow-xl">
                    <div class="text-xs font-bold uppercase tracking-wider mb-1
                                {% if case.difficulty == 'Easy' %}text-green-400
                                {% elif case.difficulty == 'Medium' %}text-yellow-400
                                {% else %}text-red-400{% endif %}">
                        {{ case.difficulty }} Case
                    </div>
                    <h3 class="font-bold text-white mb-2">{{ case.title }}</h3>
                    {% if case.status == 'locked' %}
                    <div class="text-xs text-slate-500">Solve previous case to unlock</div>
                    {% else %}
                    <div class="flex justify-center gap-4 text-xs font-bold">
                        <span class="text-yellow-400">â˜… {{ case.xp_reward }} XP</span>
                    </div>
                    <div class="mt-3 text-xs text-cyan-300">Click to Start Mission â–¶</div>
                    {% endif %}

                    <!-- Arrow Tip -->
                    <div
                        class="absolute -top-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-slate-900 border-l border-t border-cyan-500/30 transform rotate-45">
                    </div>
                </div>
            </div>
            {% endfor %}

            <!-- Coming Soon Node -->
            <div class="relative group z-10 flex flex-col items-center opacity-50">
                <div
                    class="w-20 h-20 rounded-full flex items-center justify-center border-4 border-slate-700 bg-slate-800 border-dashed">
                    <span class="text-2xl">?</span>
                </div>
                <div class="mt-4 text-slate-500 font-bold text-sm">More Coming Soon</div>
            </div>

        </div>
    </div>
</div>